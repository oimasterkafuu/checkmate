<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="/main.css" />
    <title>Checkmate!! - 首页</title>
  </head>

  <body>
    <div style="position: fixed; top: 12px; right: 12px; z-index: 20">
      <span id="account-name" style="margin-right: 8px; font-family: Quicksand-Bold"></span>
      <button id="logout-btn" class="small">退出登录</button>
    </div>
    <div style="position: fixed; right: 12px; bottom: 12px; z-index: 20">
      <button id="about-btn" class="small">关于</button>
    </div>
    <div id="menu" class="center center-tag">
      <div style="margin-bottom: 15px">
        <input type="text" id="room-input" placeholder="请输入房间号" value="" />
      </div>
      <button id="enter-room">进入房间</button><br />
      <button id="rooms" class="small">房间列表</button><br />
      <button id="replays" class="small">查看回放</button>
    </div>
    <script>
      async function loadUser() {
        const res = await fetch('/api/auth/me');
        if (!res.ok) {
          location.href = '/login';
          return;
        }
        const data = await res.json();
        $('#account-name').text(data.username);
      }
      loadUser();

      $('#enter-room').on('click', function () {
        location.href = '/games/' + $('#room-input').val();
      });
      $('#room-input').on('keypress', function (e) {
        if (e.keyCode == 13) {
          location.href = '/games/' + $('#room-input').val();
        }
      });
      $('#rooms').on('click', function () {
        location.href = '/rooms';
      });
      $('#replays').on('click', function () {
        location.href = '/replays';
      });
      $('#about-btn').on('click', function () {
        location.href = '/about';
      });
      $('#logout-btn').on('click', async function () {
        await fetch('/api/auth/logout', { method: 'POST' });
        location.href = '/login';
      });
    </script>
  </body>
</html>
